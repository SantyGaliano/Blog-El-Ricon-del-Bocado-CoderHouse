{% load static %}
<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>{% block title %}El Rincón Del Bocado{% endblock %}</title>

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet">

    <!-- Tipografías -->
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Estilos del sitio -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}?v=2025-10-18a">
    <!-- Estilos del TopBar (Aurora) -->
    <link rel="stylesheet" href="{% static 'css/topbar.css' %}?v=2025-10-18a">

    {% block extra_css %}{% endblock %}
  </head>
  <body>
    <!-- Aurora Topbar v1.1 -->
    <div id="topbar-aurora" class="topbar" aria-label="Anuncios rotativos">
      <div class="tb-bg tb-grad-0" id="tbBg"></div>
      <div class="tb-glass"></div>

      <div class="tb-inner">
        <!-- Centro: icono + frase -->
        <div class="tb-text-wrap" id="tbTextWrap">
          <span class="tb-icon" id="tbIcon" aria-hidden="true"></span>
          <span class="tb-text" id="tbText">Nuevas recetas de temporada disponibles</span>
        </div>

        <!-- Derecha: dots -->
        <div class="tb-dots" id="tbDotsRight" aria-label="Navegación de anuncios"></div>
      </div>

      <div class="tb-bottom-glow" aria-hidden="true"></div>
    </div>

    <!-- Navbar (debajo del topbar). Se ajusta con --topbar-h -->
    <nav class="navbar navbar-expand-lg navbar-dark navbar-custom fixed-top" style="top: var(--topbar-h);">
      <div class="container-fluid">
        <a class="navbar-brand" href="{% url 'home' %}">
          <img src="{% static 'images/El Rincón Del Bocado.png' %}" alt="El Rincón Del Bocado" height="32">
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu" aria-label="Abrir menú">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navMenu">
          {% with current_url=request.resolver_match.url_name|default:'' %}
          <ul class="navbar-nav ms-auto nav-modern" id="navModern">
            <i class="nav-active-underline" aria-hidden="true"></i>

            <li class="nav-item">
              <a class="nav-link modern-link {% if current_url == 'home' %}is-active{% endif %}"
                 href="{% url 'home' %}"
                 aria-current="{% if current_url == 'home' %}page{% endif %}">
                Inicio
              </a>
            </li>

            <li class="nav-item">
              <a class="nav-link modern-link {% if current_url == 'about' %}is-active{% endif %}"
                 href="{% url 'about' %}"
                 aria-current="{% if current_url == 'about' %}page{% endif %}">
                Acerca de
              </a>
            </li>

            <li class="nav-item">
              <a class="nav-link modern-link {% if current_url == 'recipe-list' %}is-active{% endif %}"
                 href="{% url 'recipe-list' %}"
                 aria-current="{% if current_url == 'recipe-list' %}page{% endif %}">
                Recetas
              </a>
            </li>

            {% if user.is_authenticated %}
              <li class="nav-item d-flex align-items-center">
                <a href="{% url 'profile' %}" class="nav-link p-0 d-flex align-items-center modern-link" style="gap:.5rem;">
                  {% if user.profile.avatar %}
                    <img src="{{ user.profile.avatar.url }}" alt="{{ user.username }}" class="avatar-nav">
                  {% else %}
                    <img src="https://i.pravatar.cc/150?u={{ user.username }}" alt="{{ user.username }}" class="avatar-nav">
                  {% endif %}
                  <span class="ms-2">{{ user.username }}</span>
                </a>
              </li>
              <li class="nav-item">
                <form method="post" action="{% url 'logout' %}" class="m-0">{% csrf_token %}
                  <button type="submit" class="nav-link btn btn-link p-0 modern-link">Cerrar sesión</button>
                </form>
              </li>
            {% else %}
              <li class="nav-item">
                <a class="nav-link modern-link {% if current_url == 'auth' %}is-active{% endif %}"
                   href="{% url 'auth' %}"
                   aria-current="{% if current_url == 'auth' %}page{% endif %}">
                  Iniciar sesión
                </a>
              </li>
            {% endif %}
          </ul>
          {% endwith %}
        </div>
      </div>
    </nav>

    {% block fullwidth_content %}{% endblock %}

    <div class="container content-container">
      {% block content %}{% endblock %}
    </div>

    <footer class="py-5 text-center text-muted">
      <small>&copy; {{ now|date:"Y" }} El Rincón Del Bocado — Cocina casera y comunidad</small>
    </footer>

    <!-- Bootstrap JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
      defer></script>

    <!-- JS del TopBar -->
    <script src="{% static 'js/topbar.js' %}?v=2025-10-18a" defer></script>

    {% block extra_js %}{% endblock %}
  </body>
</html>
